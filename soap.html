<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>牙科到宅醫療病歷表</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .section {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        h2 {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 5px;
        }
        h3 {
            color: #34495e;
            margin: 10px 0;
        }
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }
        .checkbox-item {
            display: flex;
            align-items: flex-start;
            gap: 5px;
            width: 45%;
            margin-bottom: 10px;
        }
        .location-group {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .location-checkboxes {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin: 5px 0;
        }
        .location-item {
            display: flex;
            align-items: center;
            gap: 5px;
            min-width: 100px;
        }
        .checkbox-item input[type="checkbox"] {
            margin-top: 3px;
        }
        .checkbox-item label {
            font-size: 15px;
            line-height: 1.4;
        }
        textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        button {
            background-color: #3498db;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background-color: #2980b9;
        }
        .subsection {
            margin-left: 20px;
            margin-top: 10px;
        }
        .status-group {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .status-checkboxes {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin: 5px 0;
        }
        .status-item {
            display: flex;
            align-items: center;
            gap: 5px;
            min-width: 100px;
        }
        /* .tooth-table{
            width: 25%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        .tooth-table td {
            border: 1px solid #000;
            padding: 8px;
            text-align: center;
            width: 16.66%;
            height: 20px;
        } */
        /* .tooth-table-2 td {
            border: 1px solid #000;
            padding: 8px;
            text-align: center;
            width: 16.66%;
            height: 10px;
        } */
        /* .tooth-table .center-border {
            border-right: 5px solid #000;
        } */
        /* .tooth-table .center-border-horizon {
            border-bottom: 5px solid #000;
        } */
        /* .tooth-table input {
            width: 90%;
            height: 90%;
            text-align: center;
            padding: 4px;
            border: none;
            font-size: 16px;
        }
        .tooth-table input:focus {
            outline: none;
        } */
        input#pname, input#pid, input#doctor {
            font-size: 20px; 
            width: 300px; 
            height: 50px;
        }
        .treatment-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        .treatment-grid .treatment-item,
        .treatment-grid .simple-treatment {
            width: 45%; /* 調整寬度，讓每個項目占據一半的空間 */
        }
        
        .treatment-item {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            background-color: #f8f9fa;
            border-radius: 4px;
            min-height: 40px;
        }
        
        .treatment-item-content {
            display: flex;
            align-items: center;
            width: 100%;
            justify-content: space-between;
            height: 100%;
        }
        
        .treatment-label {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-shrink: 0;
        }
        
        .treatment-label input[type="checkbox"] {
            margin: 0;
        }
        
        .treatment-label label {
            margin: 0;
            white-space: nowrap;
        }
        
        .tooth-table-2, .tooth-table {
            margin: 0;
            border-collapse: collapse;
        }
        
        .tooth-table-2, .tooth-table td {
            padding: 0 2px;
        }
        
        .tooth-table-2, .tooth-table input {
            width: 50px;
            height: 28px;
            padding: 4px;
            text-align: center;
            margin: 0;
        }
        
        .simple-treatment {
            padding: 8px 12px;
            background-color: #f8f9fa;
            border-radius: 4px;
            min-height: 40px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .simple-treatment input[type="checkbox"] {
            margin: 0;
        }

        .simple-treatment label {
            margin: 0;
        }

        @media (max-width: 768px) {
            .treatment-item-content {
                flex-wrap: wrap;
                gap: 10px;
            }
            
            .tooth-table-2 {
                margin-left: auto;
            }
        }


    </style>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const treatmentCheckboxes = document.querySelectorAll('[name="next_treatment"]');
    
            treatmentCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', () => {
                    const tableInputs = checkbox.closest('.treatment-item, .simple-treatment')?.querySelectorAll('input[type="number"]');
                    if (tableInputs) {
                        tableInputs.forEach(input => {
                            input.disabled = !checkbox.checked;
                        });
                    }
                });
    
                // 初始化狀態
                const tableInputs = checkbox.closest('.treatment-item, .simple-treatment')?.querySelectorAll('input[type="number"]');
                if (tableInputs) {
                    tableInputs.forEach(input => {
                        input.disabled = !checkbox.checked;
                    });
                }
            });
        });
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // 選取所有 location-item 的 checkbox 和對應的 tooth-table
            const locationCheckboxes = document.querySelectorAll('.location-checkboxes input[type="checkbox"]');
            const toothTables = document.querySelectorAll('.tooth-table input[type="number"]');
    
            // 初始化時禁用所有 tooth-table 的 input
            toothTables.forEach(input => input.disabled = true);
    
            // 監聽每個 location-item 的變化
            locationCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', () => {
                    // 獲取當前分組的所有 checkbox
                    const group = checkbox.closest('.location-group');
                    const inputs = group.querySelectorAll('.tooth-table input[type="number"]');
    
                    // 如果該組至少有一個 checkbox 被選中，啟用對應的 tooth-table
                    const anyChecked = Array.from(group.querySelectorAll('input[type="checkbox"]')).some(cb => cb.checked);
                    inputs.forEach(input => input.disabled = !anyChecked);
                });
            });
        });
    </script>
    
</head>
<body>
    <div class="container">
        <h1>牙科到宅醫療病歷表</h1>
        <div style="display: flex; gap: 20px;">
            <h1>
                <label for="doctor">醫師：</label>
                <input list="doctor-names" type="text" id="doctor" name="doctor_name" required>
                <datalist id="doctor-names">
                    <option value="黃立瑋 A200000001">
                    <option value="張正夫 C100000001">
                    <option value="羅可聘 J1000000001">
                    <option value="李金聰 A100000001">
                    <option value="李桑喆 F100000001">
                    <option value="鄭俊東 N100000001">
                </datalist>
            </h1>
            <h1><label for="pname">姓名：</label><input type="text" id="pname" name="pname" required></h1>
            <h1><label for="pid">身分證字號：</label><input type="text" id="pid" name="pid" required></h1>
        </div>
        <div class="section">
            <h2>主訴</h2>
            
            <div class="checkbox-group">
    
                <div class="checkbox-item">
                    <input type="checkbox" id="complaint1" name="complaint" value="洗牙 - Ask for oral examination and pain relief due to gum swelling and bleeding">
                    <label for="complaint1">洗牙 - Ask for oral examination and pain relief due to gum swelling and bleeding</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="complaint2" name="complaint" value="補牙 - Ask for oral examination and pain relief due to caries/cavity and food impaction">
                    <label for="complaint2">補牙 - Ask for oral examination and pain relief due to caries/cavity and food impaction</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="complaint3" name="complaint" value="拔牙 - Ask for oral examination and pain relief due to mobility tooth and swelling">
                    <label for="complaint3">拔牙 - Ask for oral examination and pain relief due to mobility tooth and swelling</label>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>診斷</h2>
            
            
            <div class="location-group">
                <h3>洗牙診斷</h3>
                <div>
                    <input type="checkbox" id="diagnosis1" name="diagnosis" value="洗牙診斷- FM chronic gingivitis and periodontitis with heavy calculus deposition">
                    <label for="diagnosis1">FM chronic gingivitis and periodontitis with heavy calculus deposition</label>
                </div>
            </div>

            <div class="location-group">
                <h3>補牙診斷- Cavity</h3>
                <div class="location-checkboxes">
                    <div class="location-item">
                        <input type="checkbox" id="loc_labial" name="cavity_location" value="Labial">
                        <label for="loc_labial">Labial</label>
                    </div>
                    <div class="location-item">
                        <input type="checkbox" id="loc_buccal" name="cavity_location" value="Buccal">
                        <label for="loc_buccal">Buccal</label>
                    </div>
                    <div class="location-item">
                        <input type="checkbox" id="loc_occlusal" name="cavity_location" value="Occlusal">
                        <label for="loc_occlusal">Occlusal</label>
                    </div>
                    <div class="location-item">
                        <input type="checkbox" id="loc_palatal" name="cavity_location" value="Palatal">
                        <label for="loc_palatal">Palatal</label>
                    </div>
                    <div class="location-item">
                        <input type="checkbox" id="loc_lingual" name="cavity_location" value="Lingual">
                        <label for="loc_lingual">Lingual</label>
                    </div>
                </div>
                <div style="display: flex; gap: 20px;">
                    <h4>牙位 #</h4>
                    <table class="tooth-table">
                        <tr class="center-border-horizon">
                            <td><input type="number" min="1" max="8" onblur="validateNumber(this)"></td>
                            <td><input type="number" min="1" max="8" onblur="validateNumber(this)"></td>
                            <td><input type="number" min="1" max="8" onblur="validateNumber(this)"></td>
                        </tr>
                    </table>
                </div>
            </div>

            <div class="location-group">
                <h3>補牙診斷- Caries</h3>
                <div class="location-checkboxes">
                    <div class="location-item">
                        <input type="checkbox" id="loc_labial" name="caries_location" value="Labial">
                        <label for="loc_labial">Labial</label>
                    </div>
                    <div class="location-item">
                        <input type="checkbox" id="loc_buccal" name="caries_location" value="Buccal">
                        <label for="loc_buccal">Buccal</label>
                    </div>
                    <div class="location-item">
                        <input type="checkbox" id="loc_occlusal" name="caries_location" value="Occlusal">
                        <label for="loc_occlusal">Occlusal</label>
                    </div>
                    <div class="location-item">
                        <input type="checkbox" id="loc_palatal" name="caries_location" value="Palatal">
                        <label for="loc_palatal">Palatal</label>
                    </div>
                    <div class="location-item">
                        <input type="checkbox" id="loc_lingual" name="caries_location" value="Lingual">
                        <label for="loc_lingual">Lingual</label>
                    </div>
                </div>
                <div style="display: flex; gap: 20px;">
                    <h4>牙位 #</h4>
                    <table class="tooth-table">
                        <tr class="center-border-horizon">
                            <td><input type="number" min="1" max="8" onblur="validateNumber(this)"></td>
                            <td><input type="number" min="1" max="8" onblur="validateNumber(this)"></td>
                            <td><input type="number" min="1" max="8" onblur="validateNumber(this)"></td>
                        </tr>
                    </table>
                </div>
            </div>
            
            <div class="location-group">
                <h3>拔牙診斷</h3>
                <div class="location-checkboxes">
                    <div class="location-item">
                        <input type="checkbox" id="ulcer_labial" name="ulcer_location" value="Labial">
                        <label for="ulcer_labial">periodontal mobility tooth, prognosis is poor</label>
                    </div>
                    <div class="location-item">
                        <input type="checkbox" id="ulcer_buccal" name="ulcer_location" value="Buccal">
                        <label for="ulcer_buccal">mobility retained residual root</label>
                    </div>
                </div>
                <div style="display: flex; gap: 20px;">
                    <h4>牙位 #</h4>
                    <table class="tooth-table">
                        <tr class="center-border-horizon">
                            <td><input type="number" min="1" max="8" onblur="validateNumber(this)"></td>
                            <td><input type="number" min="1" max="8" onblur="validateNumber(this)"></td>
                            <td><input type="number" min="1" max="8" onblur="validateNumber(this)"></td>
                        </tr>
                    </table>
                </div>
            </div>

            <div class="location-group">
                <h3>潰瘍診斷</h3>
                <div class="location-checkboxes">
                    <div class="location-item">
                        <input type="checkbox" id="ulcer_labial" name="ulcer_location" value="Labial">
                        <label for="ulcer_labial">Labial</label>
                    </div>
                    <div class="location-item">
                        <input type="checkbox" id="ulcer_buccal" name="ulcer_location" value="Buccal">
                        <label for="ulcer_buccal">Buccal</label>
                    </div>
                    <div class="location-item">
                        <input type="checkbox" id="ulcer_palatal" name="ulcer_location" value="Palatal">
                        <label for="ulcer_palatal">Palatal</label>
                    </div>
                    <div class="location-item">
                        <input type="checkbox" id="ulcer_lingual" name="ulcer_location" value="Lingual">
                        <label for="ulcer_lingual">Lingual</label>
                    </div>
                    side oral mucosa ulcer
                    
                </div>
                <div style="display: flex; gap: 20px;">
                    <h4>牙位 #</h4>
                    <table class="tooth-table">
                        <tr class="center-border-horizon">
                            <td><input type="number" min="1" max="8" onblur="validateNumber(this)"></td>
                            <td><input type="number" min="1" max="8" onblur="validateNumber(this)"></td>
                            <td><input type="number" min="1" max="8" onblur="validateNumber(this)"></td>
                        </tr>
                    </table>
                </div>
            </div>

            <div class="location-group">
                <h3>腫脹診斷</h3>
                <div class="location-checkboxes">
                    <div class="location-item">
                        <input type="checkbox" id="swelling_labial" name="swelling_location" value="Labial">
                        <label for="swelling_labial">Labial</label>
                    </div>
                    <div class="location-item">
                        <input type="checkbox" id="swelling_buccal" name="swelling_location" value="Buccal">
                        <label for="swelling_buccal">Buccal</label>
                    </div>
                    <div class="location-item">
                        <input type="checkbox" id="swelling_palatal" name="swelling_location" value="Palatal">
                        <label for="swelling_palatal">Palatal</label>
                    </div>
                    <div class="location-item">
                        <input type="checkbox" id="swelling_lingual" name="swelling_location" value="Lingual">
                        <label for="swelling_lingual">Lingual</label>
                    </div>
                    side periodontal swelling
                    
                </div>
                <div style="display: flex; gap: 20px;">
                    <h4>牙位 #</h4>
                    <table class="tooth-table">
                        <tr class="center-border-horizon">
                            <td><input type="number" min="1" max="8" onblur="validateNumber(this)"></td>
                            <td><input type="number" min="1" max="8" onblur="validateNumber(this)"></td>
                            <td><input type="number" min="1" max="8" onblur="validateNumber(this)"></td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>治療</h2>
            <div class="location-group">
                <h3>共同治療</h3>
                <div>
                    <input type="checkbox" id="co_treatment" name="treatment" value="First patient medical condition interview, then check up oral soft tissue conditions">
                    <label for="co_treatment">First patient medical condition interview, then check up oral soft tissue conditions</label>
                </div>
            </div> 
            <div class="location-group">
                <h3>洗牙治療</h3>
                <div>
                    <input type="checkbox" id="dental_cleaning" name="treatment" value="FM ultrasonic scaling for removal of plaque and calculus">
                    <label for="dental_cleaning">FM ultrasonic scaling for removal of plaque and calculus</label>
                </div>
            </div> 
            <div class="location-group">
                <h3>補牙治療- CRF</h3>
                <div class="location-checkboxes">
                    <div class="location-item">
                        <input type="checkbox" id="fill_labial" name="filling_location" value="Labial">
                        <label for="fill_labial">Labial</label>
                    </div>
                    <div class="location-item">
                        <input type="checkbox" id="fill_buccal" name="filling_location" value="Buccal">
                        <label for="fill_buccal">Buccal</label>
                    </div>
                    <div class="location-item">
                        <input type="checkbox" id="fill_occlusal" name="filling_location" value="Occlusal">
                        <label for="fill_occlusal">Occlusal</label>
                    </div>
                    <div class="location-item">
                        <input type="checkbox" id="fill_palatal" name="filling_location" value="Palatal">
                        <label for="fill_palatal">Palatal</label>
                    </div>
                    <div class="location-item">
                        <input type="checkbox" id="fill_lingual" name="filling_location" value="Lingual">
                        <label for="fill_lingual">Lingual</label>
                    </div>
                </div>
                surface CRF after caries removal by hand curet and self-etch adhesives with light-curing filling, polishing and finishing
                <div style="display: flex; gap: 20px;">
                    <h4>牙位 #</h4>
                    <table class="tooth-table">
                        <tr class="center-border-horizon">
                            <td><input type="number" min="1" max="8" onblur="validateNumber(this)"></td>
                            <td><input type="number" min="1" max="8" onblur="validateNumber(this)"></td>
                            <td><input type="number" min="1" max="8" onblur="validateNumber(this)"></td>
                        </tr>
                    </table>
                </div>
            </div>
            <div class="location-group">
                <h3>補牙治療- GIF</h3>
                <div class="location-checkboxes">
                    <div class="location-item">
                        <input type="checkbox" id="fill_labial_gif" name="filling_location" value="Labial">
                        <label for="fill_labial_gif">Labial</label>
                    </div>
                    <div class="location-item">
                        <input type="checkbox" id="fill_buccal_gif" name="filling_location" value="Buccal">
                        <label for="fill_buccal_gif">Buccal</label>
                    </div>
                    <div class="location-item">
                        <input type="checkbox" id="fill_occlusal_gif" name="filling_location" value="Occlusal">
                        <label for="fill_occlusal_gif">Occlusal</label>
                    </div>
                    <div class="location-item">
                        <input type="checkbox" id="fill_palatal_gif" name="filling_location" value="Palatal">
                        <label for="fill_palatal_gif">Palatal</label>
                    </div>
                    <div class="location-item">
                        <input type="checkbox" id="fill_lingual_gif" name="filling_location" value="Lingual">
                        <label for="fill_lingual_gif">Lingual</label>
                    </div>
                    
                </div>
                surface GIF after caries removal by hand curet and self-etch adhesives , polishing and finishing
                <div style="display: flex; gap: 20px;">
                    <h4>牙位 #</h4>
                    <table class="tooth-table">
                        <tr class="center-border-horizon">
                            <td><input type="number" min="1" max="8" onblur="validateNumber(this)"></td>
                            <td><input type="number" min="1" max="8" onblur="validateNumber(this)"></td>
                            <td><input type="number" min="1" max="8" onblur="validateNumber(this)"></td>
                        </tr>
                    </table>
                </div>
            </div>
            <div class="location-group">
                <h3>塗氟治療</h3>
                <div>
                    <input type="checkbox" id="treatment1" name="treatment" value="共同治療">
                    <label for="treatment1">FM fluoride application with 2.40%F fluoride gel and oral hygiene instruction</label>
                </div>
            </div> 
            <div class="location-group">
                <h3>磨牙治療</h3>
                Smooth the sharp part of the 
                <div class="location-checkboxes">
                    <div class="location-item">
                        <input type="checkbox" id="treatment_decayed_tooth" name="treatment" value="Decayed Root">
                        <label for="treatment_decayed_tooth"> Decayed Root</label>
                    </div>
                    <div class="location-item">
                        <input type="checkbox" id="treatment_decayed_tooth" name="treatment" value="Residual tooth">
                        <label for="treatment_decayed_tooth">Residual tooth</label>
                    </div>
                    <div class="location-item">
                        <input type="checkbox" id="treatment_decayed_tooth" name="treatment" value="Crown">
                        <label for="treatment_decayed_tooth">Crown</label>
                    </div>
                </div>
                <div style="display: flex; gap: 20px;">
                    <h4>牙位 #</h4>
                    <table class="tooth-table">
                        <tr class="center-border-horizon">
                            <td><input type="number" min="1" max="8" onblur="validateNumber(this)"></td>
                            <td><input type="number" min="1" max="8" onblur="validateNumber(this)"></td>
                            <td><input type="number" min="1" max="8" onblur="validateNumber(this)"></td>
                        </tr>
                    </table>
                </div>
            </div>  
            <div class="location-group">
                <h3>拔牙治療</h3>
                <div class="location-checkboxes">
                    <div class="location-item">
                        <input type="checkbox" id="topical_anesthesia" name="simple_extraction" value="Topical anesthesia">
                        <label for="topical_anesthesia">Topical anesthesia</label>
                    </div>
                    <div class="location-item">
                        <input type="checkbox" id="local_anesthesia" name="simple_extraction" value="local injection anesthesia">
                        <label for="local_anesthesia">local injection anesthesia</label>
                    </div>
                    and simple extraction
                </div>
                
                <div style="display: flex; gap: 20px;">
                    <h4>牙位 #</h4>
                    <table class="tooth-table">
                        <tr class="center-border-horizon">
                            <td><input type="number" min="1" max="8" onblur="validateNumber(this)"></td>
                            <td><input type="number" min="1" max="8" onblur="validateNumber(this)"></td>
                            <td><input type="number" min="1" max="8" onblur="validateNumber(this)"></td>
                        </tr>
                    </table>
                </div>
            </div>
            <div class="location-group">
                <h3>潰瘍治療</h3>
                <div class="location-checkboxes">
                    <div class="location-item">
                        <input type="checkbox" id="ulcer_labial_treatment" name="ulcer_treatment_location" value="Labial">
                        <label for="ulcer_labial_treatment">Labial</label>
                    </div>
                    <div class="location-item">
                        <input type="checkbox" id="ulcer_buccal_treatment" name="ulcer_treatment_location" value="Buccal">
                        <label for="ulcer_buccal_treatment">Buccal</label>
                    </div>
                    <div class="location-item">
                        <input type="checkbox" id="ulcer_palatal_treatment" name="ulcer_treatment_location" value="Palatal">
                        <label for="ulcer_palatal_treatment">Palatal</label>
                    </div>
                    <div class="location-item">
                        <input type="checkbox" id="ulcer_lingual_treatment" name="ulcer_treatment_location" value="Lingual">
                        <label for="ulcer_lingual_treatment">Lingual</label>
                    </div>
                    oral ulcer treatment with kenalog gel application
                </div>
                <div style="display: flex; gap: 20px;">
                    <h4>牙位 #</h4>
                    <table class="tooth-table">
                        <tr class="center-border-horizon">
                            <td><input type="number" min="1" max="8" onblur="validateNumber(this)"></td>
                            <td><input type="number" min="1" max="8" onblur="validateNumber(this)"></td>
                            <td><input type="number" min="1" max="8" onblur="validateNumber(this)"></td>
                        </tr>
                    </table>
                </div>
            </div>
            <div class="location-group">
                <h3>牙周治療</h3>
                <div class="location-checkboxes">
                    <div class="location-item">
                        <input type="checkbox" id="periodontal_treatment" name="periodontal_treatment" value="periodontal treatment with local scaling and curettage for swelling pain relief">
                        <label for="periodontal_treatment">periodontal treatment with local scaling and curettage for swelling pain relief</label>
                    </div>
                </div>
                <div style="display: flex; gap: 20px;">
                    <h4>牙位 #</h4>
                    <table class="tooth-table">
                        <tr class="center-border-horizon">
                            <td><input type="number" min="1" max="8" onblur="validateNumber(this)"></td>
                            <td><input type="number" min="1" max="8" onblur="validateNumber(this)"></td>
                            <td><input type="number" min="1" max="8" onblur="validateNumber(this)"></td>
                        </tr>
                    </table>
                </div>
            </div>
            <div class="location-group">
                <h3>拆線治療</h3>
                <div class="location-checkboxes">
                    <div class="location-item">
                        <input type="checkbox" id="remove_stitches" name="remove_stitches" value="remove stitches under Iodine application">
                        <label for="remove_stitches">remove stitches under Iodine application</label>
                    </div>
                </div>
                <div style="display: flex; gap: 20px;">
                    <h4>牙位 #</h4>
                    <table class="tooth-table">
                        <tr class="center-border-horizon">
                            <td><input type="number" min="1" max="8" onblur="validateNumber(this)"></td>
                            <td><input type="number" min="1" max="8" onblur="validateNumber(this)"></td>
                            <td><input type="number" min="1" max="8" onblur="validateNumber(this)"></td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>衛教 </h2>
            oral hygiene instruction for
            <div class="checkbox-group">
    
                <div class="checkbox-item">
                    <input type="checkbox" id="instruction1" name="instruction" value="mouth cleaning of the oral mucosa with some oral sponge brush">
                    <label for="instruction1">mouth cleaning of the oral mucosa with some oral sponge brush</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="instruction2" name="instruction" value="teeth cleaning with correct tooth brush, interdental brush and dental floss">
                    <label for="instruction2">teeth cleaning with correct tooth brush, interdental brush and dental floss</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="instruction3" name="instruction" value="dry mouth soothing with some oral moisturizing gel application">
                    <label for="instruction3">dry mouth soothing with some oral moisturizing gel application</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="instruction7" name="instruction" value="soft diet after filling tooth">
                    <label for="instruction7">soft diet after filling tooth</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="instruction4" name="instruction" value="fasting for 30 minutes after fluoride application">
                    <label for="instruction4">fasting for 30 minutes after fluoride application</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="instruction5" name="instruction" value="precautions after tooth extraction and give health education information">
                    <label for="instruction5">precautions after tooth extraction and give health education information</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="instruction6" name="instruction" value="having regular oral examinations">
                    <label for="instruction6">having regular oral examinations</label>
                </div>
                
            </div>
        </div>

        <div class="section">
            <h2>下次治療項目</h2>
            
            <div class="treatment-grid">
                
                <!-- 簡單項目，不需要牙位的 -->
                <div class="simple-treatment">
                    <input type="checkbox" id="next1" name="next_treatment" value="定期檢查及衛教">
                    <label for="next1">定期檢查及衛教</label>
                </div>
                
                <div class="simple-treatment">
                    <input type="checkbox" id="next2" name="next_treatment" value="塗氟">
                    <label for="next2">塗氟</label>
                </div>
        
                <!-- 需要牙位的項目 -->
                <div class="treatment-item">
                    <div class="treatment-item-content">
                        <div class="treatment-label">
                            <input type="checkbox" id="next3" name="next_treatment"  value="單面蛀牙填補">
                            <label>單面蛀牙填補</label>
                        </div>
                        <table class="tooth-table-2" id="下次治療項目_3">
                            <tr>
                                <td>#</td>
                                <td><input type="number" min="11" max="48" onblur="validateNumber(this)"></td>
                                <td><input type="number" min="11" max="48" onblur="validateNumber(this)"></td>
                                <td><input type="number" min="11" max="48" onblur="validateNumber(this)"></td>
                            </tr>
                        </table>
                    </div>
                </div>
        
                <div class="treatment-item">
                    <div class="treatment-item-content">
                        <div class="treatment-label">
                            <input type="checkbox" id="next4" name="next_treatment" value="牙結石清除">
                            <label>牙結石清除</label>
                        </div>
                        <table class="tooth-table-2" id="下次治療項目_4">
                            <tr>
                                <td>#</td>
                                <td><input type="number" min="11" max="48" onblur="validateNumber(this)"></td>
                                <td><input type="number" min="11" max="48" onblur="validateNumber(this)"></td>
                                <td><input type="number" min="11" max="48" onblur="validateNumber(this)"></td>
                            </tr>
                        </table>
                    </div>
                </div>
        
                <div class="treatment-item">
                    <div class="treatment-item-content">
                        <div class="treatment-label">
                            <input type="checkbox" id="next5" name="next_treatment" value="牙周敷料">
                            <label>牙周敷料</label>
                        </div>
                        <table class="tooth-table-2" id="下次治療項目_5">
                            <tr>
                                <td>#</td>
                                <td><input type="number" min="11" max="48" onblur="validateNumber(this)"></td>
                                <td><input type="number" min="11" max="48" onblur="validateNumber(this)"></td>
                                <td><input type="number" min="11" max="48" onblur="validateNumber(this)"></td>
                            </tr>
                        </table>
                    </div>
                </div>
        
                <div class="treatment-item">
                    <div class="treatment-item-content">
                        <div class="treatment-label">
                            <input type="checkbox" id="next6" name="next_treatment" value="牙周病緊急處理">
                            <label>牙周病緊急處理</label>
                        </div>
                        <table class="tooth-table-2" id="下次治療項目_6">
                            <tr>
                                <td>#</td>
                                <td><input type="number" min="11" max="48" onblur="validateNumber(this)"></td>
                                <td><input type="number" min="11" max="48" onblur="validateNumber(this)"></td>
                                <td><input type="number" min="11" max="48" onblur="validateNumber(this)"></td>
                            </tr>
                        </table>
                    </div>
                </div>
        
                <div class="treatment-item">
                    <div class="treatment-item-content">
                        <div class="treatment-label">
                            <input type="checkbox" id="next7" name="next_treatment" value="牙周暨齲齒控制基本處置">
                            <label>牙周暨齲齒控制基本處置</label>
                        </div>
                        <table class="tooth-table-2" id="下次治療項目_7">
                            <tr>
                                <td>#</td>
                                <td><input type="number" min="11" max="48" onblur="validateNumber(this)"></td>
                                <td><input type="number" min="11" max="48" onblur="validateNumber(this)"></td>
                                <td><input type="number" min="11" max="48" onblur="validateNumber(this)"></td>
                            </tr>
                        </table>
                    </div>
                </div>
        
                <div class="simple-treatment">
                    <input type="checkbox" id="next8" name="next_treatment" value="非特定局部治療">
                    <label for="next8">非特定局部治療</label>
                </div>
        
                <div class="treatment-item">
                    <div class="treatment-item-content">
                        <div class="treatment-label">
                            <input type="checkbox" id="next9" name="next_treatment" value="特定局部治療">
                            <label>特定局部治療</label>
                        </div>
                        <table class="tooth-table-2" id="下次治療項目_9">
                            <tr>
                                <td>#</td>
                                <td><input type="number" min="11" max="48" onblur="validateNumber(this)"></td>
                                <td><input type="number" min="11" max="48" onblur="validateNumber(this)"></td>
                                <td><input type="number" min="11" max="48" onblur="validateNumber(this)"></td>
                            </tr>
                        </table>
                    </div>
                </div>
        
                <div class="treatment-item">
                    <div class="treatment-item-content">
                        <div class="treatment-label">
                            <input type="checkbox" id="next10" name="next_treatment" value="簡單性拔牙">
                            <label>簡單性拔牙</label>
                        </div>
                        
                        <table class="tooth-table-2" id="下次治療項目_10">
                            <tr>
                                <td>#</td>
                                <td><input type="number" min="11" max="48" onblur="validateNumber(this)"></td>
                                <td><input type="number" min="11" max="48" onblur="validateNumber(this)"></td>
                                <td><input type="number" min="11" max="48" onblur="validateNumber(this)"></td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>
     

        <div class="section">
            <h2>備註 (Notes)</h2>
            <textarea id="notes" rows="4"></textarea>
        </div>



        <button onclick="exportToCSV()">輸出CSV</button>
    </div>
</body>
<script>
function validateNumber(input) {
        const validRanges = [
            [11, 18],
            [21, 28],
            [31, 38],
            [41, 48]
        ];

        let value = parseInt(input.value, 10);

        // 檢查是否為有效數字，並確認是否在有效範圍內
        if (!isNaN(value) && validRanges.some(range => value >= range[0] && value <= range[1])) {
            // 數值有效，不做任何處理
            return;
        } else {
            // 清空無效輸入
            input.value = '';

        }
    }
    function exportToCSV() {
        const rows = [];
        const name = document.getElementById('pname').value;
        const id = document.getElementById('pid').value;
        const doctor = document.getElementById('doctor').value;
        const date = new Date().toISOString().split('T')[0];
        if (!name.trim()) {
            alert('請輸入姓名！');
            return; // Stop the function if the name field is empty
        }
        if (!id.trim()) {
            alert('請輸入身份證字號！');
            return; // Stop the function if the name field is empty
        }
        if (!doctor.trim()) {
            alert('請輸入醫生姓名！');
            return; // Stop the function if the name field is empty
        }
        rows.push(['category', 'subcategory', 'content']);
        rows.push(['姓名', '',`"${name}"`]);
        rows.push(['身份證字號', '', `"${id}"`])
        rows.push(['醫生', '', `"${doctor}"`])
        rows.push(['日期', '', `"${date}"`])
        let categoryCounters = { 主訴: 0, 診斷: 0, 治療: 0, 衛教: 0, 下次治療項目: 0 };

        function addRow(category, content, checked, subCategory = '') {
            categoryCounters[category]++;
            const fullCategory = subCategory ? `${category}_${subCategory}_${categoryCounters[category]}` : `${category}_${categoryCounters[category]}`;
            rows.push([fullCategory, `"${content.replace(/"/g, '""')}"`, checked]);
        }

        // Helper to get the nearest h3 text
        function getParentH3(element) {
            const h3 = element.closest('.location-group, .treatment-item, .treatment-grid')?.querySelector('h3');
            return h3 ? h3.textContent.trim() : '';
        }

        // Main Complaints (主訴)
        document.querySelectorAll('[name="complaint"]').forEach(el => {
            addRow('主訴', el.value, el.checked);
        });

        // Diagnoses (診斷)
        document.querySelectorAll('[id="diagnosis1"]').forEach(el => {
            const subCategory = getParentH3(el);
            addRow('診斷', el.value, el.checked, subCategory);
        });

        document.querySelectorAll('[name="cavity_location"]').forEach(el => {
            const subCategory = getParentH3(el);
            addRow('診斷', el.value + ' cavity', el.checked, subCategory);
        });

        document.querySelectorAll('[name="caries_location"]').forEach(el => {
            const subCategory = getParentH3(el);
            addRow('診斷', el.value + ' caries', el.checked, subCategory);
        });

        document.querySelectorAll('[name="ulcer_location"]').forEach(el => {
            const subCategory = getParentH3(el);
            const suffix = el.id.startsWith('ulcer_') ? ' side oral mucosa ulcer' : '';
            addRow('診斷', el.value + suffix, el.checked, subCategory);
        });

        document.querySelectorAll('[name="swelling_location"]').forEach(el => {
            const subCategory = getParentH3(el);
            addRow('診斷', el.value + ' side periodontal swelling', el.checked, subCategory);
        });

        // Treatments (治療)
        document.querySelectorAll('[id="co_treatment"]').forEach(el => {
            const subCategory = getParentH3(el);
            addRow('治療', el.value, el.checked, subCategory);
        });

        document.querySelectorAll('[id="dental_cleaning"]').forEach(el => {
            const subCategory = getParentH3(el);
            addRow('治療', el.value, el.checked, subCategory);
        });

        document.querySelectorAll('[name="treatment"]').forEach(el => {
            const subCategory = getParentH3(el);
            if (el.id.startsWith('treatment_decayed')) {
                addRow('治療', `Smooth the sharp part of the ${el.value}`, el.checked, subCategory);
            }
        });

        document.querySelectorAll('[name="filling_location"]').forEach(el => {
            const subCategory = getParentH3(el);
            const suffix = el.id.includes('gif') ? ' surface GIF after caries removal...' : ' surface CRF after caries removal...';
            addRow('治療', el.value + suffix, el.checked, subCategory);
        });

        document.querySelectorAll('[id="topical_anesthesia"], [id="local_anesthesia"]').forEach(el => {
            const subCategory = getParentH3(el);
            addRow('治療', el.value + ' and simple extraction', el.checked, subCategory);
        });

        document.querySelectorAll('[name="ulcer_treatment_location"]').forEach(el => {
            const subCategory = getParentH3(el);
            addRow('治療', el.value + ' oral ulcer treatment...', el.checked, subCategory);
        });

        document.querySelectorAll('[id="periodontal_treatment"], [id="remove_stitches"]').forEach(el => {
            const subCategory = getParentH3(el);
            addRow('治療', el.value, el.checked, subCategory);
        });

        // Health Education (衛教)
        document.querySelectorAll('[id^="instruction"]').forEach(el => {
            addRow('衛教', el.value, el.checked);
        });

        // Next Treatment (下次治療項目)
        document.querySelectorAll('[name="next_treatment"]').forEach(el => {
            const subCategory = getParentH3(el);
            addRow('下次治療項目', el.value, el.checked, subCategory);
        });

        // Notes (備註)
        const notes = document.getElementById('notes').value || '';
        rows.push(['備註', `"${notes.replace(/"/g, '""')}"`]);

        // Teeth Table Data
        document.querySelectorAll('.tooth-table, .tooth-table-2').forEach((table, tableIndex) => {
            let subCategory = getParentH3(table);
            if (!subCategory) {
                subCategory = table.id
            }
            const inputs = table.querySelectorAll('input[type="number"]');
            inputs.forEach((input, inputIndex) => {
                const value = input.value || '';
                rows.push([`${subCategory}`, `牙位_${inputIndex + 1}`, value]);
            });
        });

        // Generate and Download CSV
        
        const fileName = name ? `tooth_status_${name}_${id}_${date}.csv` : 'tooth_status.csv';
        const csvContent = rows.map(row => row.join(',')).join('\n');
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        const url = URL.createObjectURL(blob);
        link.setAttribute('href', url);
        link.setAttribute('download', fileName);
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

</script>
</html>